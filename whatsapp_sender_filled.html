<script>
    // Função para obter os parâmetros da URL
    function getQueryParam(param) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
    }

    // Preenche os campos se houver parâmetros na URL
    window.onload = function () {
        const phoneFromURL = getQueryParam("phone");
        const messageFromURL = getQueryParam("message");

        if (phoneFromURL) document.getElementById("phone").value = phoneFromURL;
        if (messageFromURL) document.getElementById("message").value = decodeURIComponent(messageFromURL);
    };

    // Envio do formulário
    document.getElementById("whatsappForm").addEventListener("submit", function(event) {
        event.preventDefault();

        const instanceId = document.getElementById("instanceId").value;
        const token = document.getElementById("token").value;
        const phone = document.getElementById("phone").value;
        const message = document.getElementById("message").value;

        const url = `https://api.ultramsg.com/${instanceId}/messages/chat`;
        const formData = new URLSearchParams();
        formData.append("token", token);
        formData.append("to", phone);
        formData.append("body", message);

        fetch(url, {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            document.getElementById("response").innerText = "Resposta da API: " + JSON.stringify(data, null, 2);
        })
        .catch(error => {
            document.getElementById("response").innerText = "Erro: " + error;
        });
    });
</script>
